<div class="freelance-all-gig-wrapper">
  <div class="">
    <section>
      <div class="row no-gutters">
        <div class="col-md-3 col-sm-12 bg-white" *ngIf="!sharedService.deviceDetectorService.isMobile()">
          <app-left-side *ngIf="user"></app-left-side>
        </div>
        <div class="col-md-7 col-sm-12 main-div mb-4">
          <ol class="breadcrumb mt-3">
            <li class="breadcrumb-item curPoint"><a [routerLink]="['/home']">Home</a></li>
            <li class="breadcrumb-item active"><a>All Gigs</a></li>
          </ol>

          <ng-container>
            <mat-tab-group>
              <mat-tab label="All gigs">
                <ng-container *ngIf="!gigConfig.isLoading">
                  <ng-container *ngTemplateOutlet="allGigs"></ng-container>
                </ng-container>
                <ng-container *ngIf="gigConfig.isLoading">
                  <ng-container *ngTemplateOutlet="loader"></ng-container>
                </ng-container>
              </mat-tab>
              <mat-tab label="All Freelancers">
                <ng-template *ngTemplateOutlet="freelancerList"></ng-template>
              </mat-tab>
            </mat-tab-group>
          </ng-container>

          <!-- <ng-container *ngIf="!gigConfig.isLoading">
            <ng-container *ngTemplateOutlet="allGigs"></ng-container>
          </ng-container>
          <ng-container *ngIf="gigConfig.isLoading">
            <ng-container *ngTemplateOutlet="loader"></ng-container>
          </ng-container> -->
        </div>
        <div class="col-md-2 col-sm-12 bg-white" *ngIf="!sharedService.deviceDetectorService.isMobile()">
          <app-right-side *ngIf="user"></app-right-side>
        </div>
      </div>
    </section>
  </div>
</div>

<ng-template #allGigs>
  <ng-container *ngIf="gigConfig.data.length">
    <mat-paginator
      class="col-12"
      [length]="gigConfig.data.length"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="pageEvent = pagination($event)"
    >
    </mat-paginator>
  </ng-container>

  <div class="row w100 no-gutters animated fadeIn">
    <div class="col-12 mt-4">
      <div class="text-center">
        <mat-form-field class="example-form-field w40 m-auto" *ngIf="!gigConfig.isLoading" style="font-size: 16px;">
          <mat-label>Search Gigs</mat-label>
          <input matInput type="text" (keyup)="onSearchGig()" [(ngModel)]="gigConfig.gigSearchText" />
          <button
            mat-button
            *ngIf="gigConfig.gigSearchText"
            matSuffix
            mat-icon-button
            aria-label="Clear"
            placeholder="Min 3 Char..."
            (click)="gigConfig.gigSearchText = ''; fetchUserGig(1)"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </div>
    </div>
    <div class="col-12 col-md-4" *ngFor="let item of gigConfig.data">
      <div class="p-2">
        <div class="card m-0 mt-4">
          <div class="card-img">
            <img [src]="item.image" *ngIf="item.video === ''" />
            <ng-container *ngIf="item.image !== '' && item.video !== ''">
              <owl-carousel-o [options]="gigAssetsOptions" class="gig-view-carousel">
                <ng-template carouselSlide>
                  <div style="background: #ebe9ed;">
                    <video controls>
                      <source [src]="item.video" type="video/mp4" />
                      <source [src]="item.video" type="video/ogg" />
                      Your browser does not support the video tag.
                    </video>
                  </div>
                </ng-template>
                <ng-template carouselSlide>
                  <div style="background: #ebe9ed;">
                    <img [src]="item.image" class="img-thumbnail gig-img" alt="course" />
                  </div>
                </ng-template>
              </owl-carousel-o>
            </ng-container>
          </div>
          <div class="card-body pl-3 pr-3" [ngClass]="{ 'margin-top-15px': item.image !== '' && item.video !== '' }">
            <div class="d-flex align-items-center justify-content-center">
              <img
                [src]="item.userImage"
                [routerLink]="['/social-network/profile/', item.tasaId]"
                routerLinkActive="router-link-active"
                class="user-img curPoint"
                alt=""
              />
              <div>
                <div class="font400 pl-0 text-truncate" [title]="item.userName">{{ item.userName }}</div>
                <ng-container *ngIf="item.ratingCount !== 0">
                  <ngb-rating [readonly]="true" [max]="5" class="star" [(rate)]="item.rating"></ngb-rating>
                  <span class="text-muted" matTooltipPosition="below" matTooltip="Count of rating"
                    >({{ item.ratingCount }})</span
                  >
                </ng-container>
                <ng-container *ngIf="item.ratingCount === 0">
                  <span class="text-muted">Rating not available</span>
                </ng-container>
              </div>
            </div>
            <h5 class="card-title mt-3 mb-1 text-truncate" [title]="item.title">
              {{ item.title }}
            </h5>
            <p class="card-intro">
              {{ item.category }}
            </p>
          </div>
          <div class="card-footer">
            <div class="w100">
              <div class="text-center">
                <button
                  mat-mini-fab
                  color="primary"
                  [routerLink]="['/freelance/gig/', item.id]"
                  routerLinkActive="router-link-active"
                  matTooltipPosition="below"
                  class="mr-2"
                  matTooltip="View Gig"
                >
                  <mat-icon class="mb-1">remove_red_eye</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <ng-container *ngIf="!gigConfig.isLoading && gigConfig.data.length == 0">
      <ng-template
        [ngTemplateOutlet]="noData"
        [ngTemplateOutletContext]="{ msg: 'No Gigs Found...!' }"
      ></ng-template>
    </ng-container>
  </div>
</ng-template>

<ng-template #freelancerList>
  <div class="text-center mt-4">
    <mat-form-field class="example-form-field m-auto w40" style="font-size: 16px;">
      <mat-label>Search Freelancers</mat-label>
      <input matInput type="text" (keyup)="fetchFreelancers()" [(ngModel)]="freelanceConfig.freelancerSearchText" />
      <button
        mat-button
        *ngIf="freelanceConfig.freelancerSearchText"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        placeholder="For EX: html | Min 3 Char..."
        (click)="freelanceConfig.freelancerSearchText = ''; fetchFreelancers()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
  </div>
  <div
    *ngIf="!freelanceConfig.isLoading"
    class="row w100 no-gutters animated fadeIn p-2 min-vertical-h-80 max-vertical-h-80 stylishSlimScroll flow-y-auto flow-x-hidden"
  >
    <div class="col-12 mt-4 shadow-sm" *ngFor="let item of freelanceConfig.data">
      <div class="row no-gutters p-4">
        <div class="col-2 d-flex align-items-center justify-content-center">
          <img
            src="{{
              item.image
                ? item.image
                : 'https://raw.githubusercontent.com/azouaoui-med/pro-sidebar-template/gh-pages/src/img/user.jpg'
            }}"
            class="user-img"
            alt=""
          />
        </div>
        <div class="col-8 text-left">
          <h4 class="mb-1">{{ item.fullName }}</h4>
          <h6 class="text-muted text-truncate font400" *ngIf="item.currentJobTitle">{{ item.currentJobTitle }}</h6>
          <h6 class="text-muted text-truncate font400" [title]="item.profileSummary">{{ item.profileSummary }}</h6>
        </div>
        <div class="col-2 text-left">
          <button mat-flat-button class="rounded-pill text-white" (click)="viewFreelance(item)" color="primary">
            View Profile
          </button>
        </div>
        <div class="col-10 mt-2">
          <h6 class="font400">{{ item.bio }}</h6>
        </div>
        <div class="col-12">
          <span
            class="badge badge-dark ml-1 mt-1"
            style="font-size: 15px;"
            *ngFor="let item of item.fieldsOfExpertise; let first = first"
            >{{ item.areaOfExpertise }}</span
          >
        </div>
      </div>
    </div>

    <ng-container *ngIf="!freelanceConfig.isLoading && freelanceConfig.data.length == 0">
      <ng-template
        [ngTemplateOutlet]="noData"
        [ngTemplateOutletContext]="{ msg: 'No Freelancer Found...!' }"
      ></ng-template>
    </ng-container>
  </div>

  <ng-container *ngIf="freelanceConfig.isLoading">
    <ng-container *ngTemplateOutlet="loader"></ng-container>
  </ng-container>
</ng-template>

<ng-template #loader>
  <ng-container>
    <div class="row">
      <div class="col-md-4 col-lg-4 col-sm-6 animated fadeIn" *ngFor="let item of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]">
        <div class="p-2">
          <div class="card m-0 mb-4">
            <div class="card-img skeleton">
              <!-- waiting for img to load from javascript -->
            </div>
            <div class="card-body">
              <h2 class="card-title skeleton">
                <!-- wating for title to load from javascript -->
              </h2>
              <p class="card-intro skeleton">
                <!-- waiting for intro to load from Javascript -->
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>

<ng-template #noData let-msg="msg">
  <div class="text-center m-auto animated fadeIn">
    <div class="col-12 text-center">
      <img src="../assets/images/no-record.gif" style="height: 300px;" class="d-block m-auto" />
      <h6 class="text-primary">{{ msg }}</h6>
    </div>
  </div>
</ng-template>
