<div class="my-orders-wrapper container-fluid w70">
  <div class="">
    <section>
      <ol class="breadcrumb mt-3">
        <li class="breadcrumb-item curPoint"><a [routerLink]="['/home']">Home</a></li>
        <li class="breadcrumb-item active"><a>My Engagements</a></li>
      </ol>
      <div class="sec-title">
        <div class="title">All Engagements</div>
      </div>

      <mat-tab-group>
        <mat-tab label="My Assignments">
          <ng-container *ngIf="!allAssignmentConfig.isLoading">
            <ng-container *ngTemplateOutlet="allAssignment"></ng-container>
          </ng-container>
          <ng-container *ngIf="allAssignmentConfig.isLoading">
            <ng-container *ngTemplateOutlet="loader"></ng-container>
          </ng-container>
        </mat-tab>
        <mat-tab label="My Bids">
          <ng-container *ngIf="!allAssignmentConfig.isLoading">
            <ng-container *ngTemplateOutlet="allBids"></ng-container>
          </ng-container>
          <ng-container *ngIf="allAssignmentConfig.isLoading">
            <ng-container *ngTemplateOutlet="loader"></ng-container>
          </ng-container>
        </mat-tab>
      </mat-tab-group>
    </section>
  </div>
</div>

<ng-template #allAssignment>
  <div class="row w100 no-gutters animated fadeIn pb-4">
    <div class="col-12 col-md-4" *ngFor="let item of allAssignmentConfig.data">
      <div class="p-2">
        <ng-template [ngTemplateOutlet]="allAssignments" [ngTemplateOutletContext]="{ data: item }"> </ng-template>
      </div>
    </div>

    <ng-container *ngIf="!allAssignmentConfig.isLoading && allAssignmentConfig.data.length === 0">
      <div class="text-center m-auto animated fadeIn">
        <div class="col-12 text-center">
          <img src="../assets/images/no-record.gif" style="height: 300px;" class="d-block m-auto" />
          <h6 class="text-primary">No Assignments Found...!</h6>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<ng-template #allAssignments let-data="data">
  <div class="card m-0 mt-4  animated fadeInUp">
    <div class="card-img pb-1 d-flex align-items-center text-center justify-content-center">
      <h6 class="text-css m-auto caps" *ngIf="data.winningGigCardId === ''">Custom Gig</h6>
      <h6 class="text-css m-auto caps" *ngIf="data.winningGigCardId !== ''">Gig Card</h6>
    </div>
    <div class="card-body pl-3 pr-3">
      <div class="row no-gutters">
        <div class="col-12 pt-3 pl-2 bg-primary-more-light">
          <div class="d-flex mb-4">
            <img
              src="{{
                data.postedByImage !== ''
                  ? data.postedByImage
                  : 'https://raw.githubusercontent.com/azouaoui-med/pro-sidebar-template/gh-pages/src/img/user.jpg'
              }} "
              [routerLink]="['/social-network/profile/', data.postedByTasaId]"
              routerLinkActive="router-link-active"
              class="user-img curPoint"
              alt=""
            />
            <div>
              <h6 class="mb-1" *ngIf="data.winningGigCardId !== ''">Buyer</h6>
              <h6 class="mb-1" *ngIf="data.winningGigCardId === ''">Seller</h6>
              <div class="font400 pl-0 text-truncate d-flex align-items-center" [title]="data.postedByName">
                {{ data.postedByName }}
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 pt-3 pl-2 mt-2 bg-primary-more-light">
          <div class="d-flex mb-4">
            <img
              src="{{
                data.winningUserImage !== ''
                  ? data.winningUserImage
                  : 'https://raw.githubusercontent.com/azouaoui-med/pro-sidebar-template/gh-pages/src/img/user.jpg'
              }} "
              [routerLink]="['/social-network/profile/', data.winningTasaId]"
              routerLinkActive="router-link-active"
              class="user-img curPoint"
              alt=""
            />
            <div>
              <h6 class="mb-1" *ngIf="data.winningGigCardId === ''">Winning User</h6>
              <h6 class="mb-1" *ngIf="data.winningGigCardId !== ''">Seller</h6>
              <div class="font400 pl-0 text-truncate d-flex align-items-center" [title]="data.winningUserName">
                {{ data.winningUserName }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex align-items-center justify-content-center mt-2">
        <div class="col-12 p-0">
          <h6 class="mb-2">
            Progress <span class="text-muted">{{ data.completePerc }}%</span>
          </h6>
          <mat-progress-bar
            [ngClass]="{
              'progress-red': data.completePerc <= 50,
              'progress-green': data.completePerc > 50 && data.completePerc <= 80,
              'progress-theme': data.completePerc > 80
            }"
            [mode]="'determinate'"
            [value]="data.completePerc"
          ></mat-progress-bar>
        </div>
      </div>
    </div>
    <div class="card-footer">
      <div class="w100">
        <div class="text-center">
          <div class="row no-gutters mb-2" *ngIf="data.winningTasaId != user.tasaId && !data.isCompleted">
            <div class="col-12 mb-1">
              <div class="form-group text-left">
                <label class="form-label" for="status">Stage<span class="text-danger pl-1 asterisk">*</span></label>
                <mat-select
                  id="status"
                  [(ngModel)]="data.stage"
                  [value]="data.stage"
                  class="form-control form-control-prepended"
                >
                  <mat-option
                    [value]="item.value"
                    [disabled]="item.disable"
                    *ngFor="let item of data.requirementProgressStatus"
                  >
                    {{ item.value }}
                  </mat-option>
                </mat-select>
              </div>
            </div>
            <div class="col-12">
              <button mat-flat-button color="primary" class="rounded-pill" (click)="changeReqStage(data)">
                <span>Change Stage</span>
              </button>
            </div>
          </div>
          <div class="text-center" *ngIf="data.isCompleted">
            <img
              class="message-icon animated fadeInUp"
              style="width: 90px; height: 90px;"
              src="../assets/images/success.svg"
              alt=""
            />
            <h4 class="message-text animated fadeInUp font700 text-shadow-theme text-primary">Work Done!</h4>
          </div>
          <button
            mat-mini-fab
            color="primary"
            [routerLink]="['/freelance/order/requirement/', data.id]"
            routerLinkActive="router-link-active"
            matTooltipPosition="below"
            class="mr-2"
            matTooltip="View Details"
          >
            <mat-icon class="mb-1">remove_red_eye</mat-icon>
          </button>
          <button
            mat-mini-fab
            color="link"
            matTooltipPosition="below"
            class="mr-2"
            *ngIf="checkShowDownloadInvoice(data)"
            (click)="downloadInvoice(data)"
            matTooltip="Download Invoice"
          >
            <mat-icon class="mb-1">file_download</mat-icon>
          </button>
          <button
            mat-flat-button
            color="primary"
            class="rounded-pill"
            *ngIf="data.isCompleted && data.postedByTasaId == user.tasaId"
            (click)="openFeedbackPopup(data)"
          >
            <span>Feedback</span>
          </button>
          <button
            mat-flat-button
            color="primary"
            *ngIf="data.isCompleted && data.winningTasaId == user.tasaId && data.sellerInvoiceGenerated === 'N'"
            class="rounded-pill"
            (click)="paymentToFreelancer(data)"
          >
            <span>Pay Out</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #allBids>
  <div class="row w100 all-bids no-gutters animated fadeIn pb-4 pt-4">
    <div class="col-12 col-md-6" *ngFor="let item of allBidConfig.data; let i = index">
      <div class="card m-0 mt-4 mr-4 animated fadeInUp">
        <div class="card-body pl-3 pr-3 pb-0">
          <div class="row no-gutters">
            <div class="col-12 pt-3 pl-2">
              <div class="d-flex mb-4">
                <img
                  src="{{
                    item.requirementByImage !== ''
                      ? item.requirementByImage
                      : 'https://raw.githubusercontent.com/azouaoui-med/pro-sidebar-template/gh-pages/src/img/user.jpg'
                  }} "
                  [routerLink]="['/social-network/profile/', item.requirementByImage]"
                  routerLinkActive="router-link-active"
                  class="user-img curPoint"
                  alt=""
                />
                <div>
                  <h6 class="mb-1">Posted By</h6>
                  <div class="font400 pl-0 text-truncate d-flex align-items-center" [title]="item.requirementByName">
                    {{ item.requirementByName }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="ml-4 mr-4">
          <mat-accordion>
            <div class="animated fadeInUp w100 mb-3" id="jobPanel-{{ i }}">
              <mat-expansion-panel class="jobs-panel">
                <mat-expansion-panel-header class="d-flex align-items-center">
                  <mat-panel-title class="pt-3">
                    <h6 class="text-primary mt-2 pb-2">
                      {{ item.userName }} <span class="text-muted ml-1">({{ item.deliveryPrice | currency }})</span>
                    </h6>
                  </mat-panel-title>
                  <mat-panel-description class="justify-content-end">
                    <div class="text-right d-flex align-items-center">
                      <span
                        class="badge p-2 ml-1 mt-2 caps"
                        [ngClass]="{
                          'badge-secondary': item.status === requirementStatus[0].value,
                          'badge-warning': item.status === requirementStatus[1].value,
                          'badge-dark': item.status === requirementStatus[2].value,
                          'badge-success': item.status === requirementStatus[3].value,
                          'badge-danger': item.status === requirementStatus[4].value
                        }"
                        style="z-index: 9; right: 10px;"
                        >{{ item.status }}</span
                      >
                      <!-- <span class="pr-1 p-1" *ngFor="let item of job.desiredSkill"
                          ><badge class="badge badge-info">{{ item }}</badge></span
                        > -->
                    </div>
                  </mat-panel-description>
                </mat-expansion-panel-header>
                <div class="mt-4">
                  <div class="row no-gutters animated fadeInUp">
                    <div class="col-12 col-md-6">
                      <div class="form-group text-left mr-2">
                        <label class="form-label" for="cost"
                          >Cost <span class="text-danger pl-1 asterisk">*</span></label
                        >
                        <div class="input-group input-group-merge">
                          <input
                            id="cost"
                            type="number"
                            min="0"
                            step="1"
                            readonly
                            oninput="validity.valid||(value='');"
                            [(ngModel)]="item.cost"
                            class="form-control form-control-prepended"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="form-group text-left">
                        <label class="form-label" for="tat"
                          >Turn Around Time <span class="text-danger pl-1 asterisk">*</span></label
                        >
                        <div class="input-group input-group-merge">
                          <input
                            id="tat"
                            type="number"
                            min="0"
                            step="1"
                            readonly
                            oninput="validity.valid||(value='');"
                            [(ngModel)]="item.tat"
                            class="form-control form-control-prepended"
                          />
                        </div>
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="form-group text-left">
                        <label class="form-label" for="Attachment">Attachment</label>
                        <div class="input-group input-group-merge">
                          <div
                            *ngIf="item.attachment !== ''"
                            class="p-2 d-flex align-items-center curPoint bg-primary-light"
                          >
                            <span class="material-icons pr-3">
                              attach_file
                            </span>
                            <a
                              [href]="item.attachment"
                              target="_blank"
                              color="primary"
                              class="mr-2"
                              download
                              matTooltipPosition="below"
                              matTooltip="View Attachment"
                            >
                              View Attachment
                            </a>
                          </div>
                          <div
                            *ngIf="item.attachment === ''"
                            class="p-2 d-flex align-items-center curPoint bg-primary-light"
                          >
                            No Attachments
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-12 col-md-6">
                      <div class="form-group text-left">
                        <label class="form-label" for="negotiable"
                          >Negotiable<span class="text-danger pl-1 asterisk">*</span></label
                        >
                        <mat-select
                          id="negotiable"
                          disabled="true"
                          [(ngModel)]="item.negotiable"
                          [(value)]="item.negotiable"
                          class="form-control form-control-prepended"
                        >
                          <mat-option [value]="'Y'">
                            Yes
                          </mat-option>
                          <mat-option [value]="'N'">
                            No
                          </mat-option>
                        </mat-select>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="form-group text-left">
                        <label class="form-label" for="description"
                          >Description <span class="text-danger pl-1 asterisk">*</span></label
                        >
                        <textarea
                          name="description"
                          [(ngModel)]="item.description"
                          class="form-control form-control-prepended"
                          cols="30"
                          rows="10"
                          readonly
                          style="min-height: 100px; max-height: 100px;"
                        ></textarea>
                      </div>
                    </div>
                  </div>
                </div>
              </mat-expansion-panel>
            </div>
          </mat-accordion>
        </div>
        <div class="card-footer">
          <div class="text-center">
            <button
              mat-mini-fab
              color="primary"
              [routerLink]="['/freelance/requirement/', item.requirementId]"
              routerLinkActive="router-link-active"
              matTooltipPosition="below"
              class="mr-2"
              matTooltip="View Details"
            >
              <mat-icon class="mb-1">remove_red_eye</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>

    <ng-container *ngIf="!allBidConfig.isLoading && allBidConfig.data.length === 0">
      <div class="text-center m-auto animated fadeIn">
        <div class="col-12 text-center">
          <img src="../assets/images/no-record.gif" style="height: 300px;" class="d-block m-auto" />
          <h6 class="text-primary">No Bids Found...!</h6>
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>

<ng-template #loader>
  <ng-container>
    <div class="row mt-2">
      <div class="col-md-4 col-12 animated fadeInUp" *ngFor="let item of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]">
        <div class="card m-0 mb-4">
          <div class="card-img skeleton">
            <!-- waiting for img to load from javascript -->
          </div>
          <div class="card-body">
            <h2 class="card-title skeleton">
              <!-- wating for title to load from javascript -->
            </h2>
            <p class="card-intro skeleton">
              <!-- waiting for intro to load from Javascript -->
            </p>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</ng-template>
